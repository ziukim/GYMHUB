# 회원 탈퇴 기능 구현 고려사항

## 구현 완료 사항

### 1. 백엔드 구현
- **MemberMapper**: `withdrawMember` 메서드 추가
- **member-mapper.xml**: STATUS를 'N'으로 변경하는 UPDATE 쿼리 추가
- **MemberService**: 비밀번호 확인 후 탈퇴 처리하는 로직 구현
- **MemberController**: `/withdrawMember.me` 엔드포인트 추가

### 2. 프론트엔드 구현
- **memberInfo.jsp**: 
  - 프로필 카드에 "회원 탈퇴" 버튼 추가
  - 회원 탈퇴 모달 추가 (비밀번호 확인 및 주의사항 표시)
  - JavaScript로 최종 확인 다이얼로그 추가

## 고려해야 할 사항

### 1. 데이터 무결성 관련

#### 1.1 연관 데이터 처리
- **회원권(MEMBERSHIP)**: 탈퇴 회원의 회원권 상태 처리 필요
  - 현재 진행 중인 회원권이 있는 경우 환불 정책 결정
  - 회원권 상태를 '중단' 또는 '환불'로 변경할지 결정
  
- **PT 예약(PT_RESERVE, PT_BOOKING)**: 
  - 예정된 PT 예약이 있는 경우 처리 방법 결정
  - 자동 취소 처리 또는 트레이너에게 알림 필요
  
- **락커(LOCKER)**: 
  - 사용 중인 락커가 있는 경우 처리 방법 결정
  - 락커 해제 및 반납 처리 필요
  
- **출석 기록(ATTENDANCE)**: 
  - 탈퇴 회원의 출석 기록 보관 여부 결정
  - 통계 데이터 유지를 위해 보관 권장
  
- **인바디 기록(INBODY)**: 
  - 탈퇴 회원의 인바디 기록 보관 여부 결정
  - 개인정보 보호법에 따라 일정 기간 후 삭제 고려

#### 1.2 외래키 제약조건
- 다른 테이블에서 MEMBER_NO를 참조하는 경우:
  - CASCADE DELETE 설정 여부 확인
  - 또는 SOFT DELETE 방식으로 STATUS만 변경 (현재 구현 방식)

### 2. 보안 관련

#### 2.1 비밀번호 확인
- ✅ 현재 구현: 비밀번호 확인 후 탈퇴 처리
- 추가 고려사항:
  - 탈퇴 전 최종 확인 다이얼로그 (✅ 구현 완료)
  - 탈퇴 사유 수집 (선택사항)

#### 2.2 세션 처리
- ✅ 현재 구현: 탈퇴 성공 시 세션 무효화
- 추가 고려사항:
  - 모든 기기에서 로그아웃 처리 필요 시 토큰 무효화 로직 추가

### 3. 비즈니스 로직 관련

#### 3.1 탈퇴 정책
- **즉시 탈퇴**: 현재 구현 방식
- **유예 기간**: 일정 기간 후 완전 삭제 (예: 30일)
- **복구 기간**: 탈퇴 후 일정 기간 내 복구 가능

#### 3.2 재가입 제한
- 동일 아이디로 재가입 제한 여부 결정
- 이메일/전화번호 재사용 제한 여부 결정
- 탈퇴 후 재가입 대기 기간 설정

#### 3.3 환불 정책
- 진행 중인 회원권 환불 처리
- 미사용 PT 횟수 환불 처리
- 락커 사용료 환불 처리

### 4. 사용자 경험(UX) 관련

#### 4.1 탈퇴 전 안내
- ✅ 현재 구현: 모달에 주의사항 표시
- 추가 고려사항:
  - 탈퇴 사유 선택 옵션
  - 개선 의견 수집

#### 4.2 탈퇴 후 처리
- ✅ 현재 구현: 메인 페이지로 리다이렉트
- 추가 고려사항:
  - 탈퇴 완료 안내 페이지 표시
  - 이메일/문자 알림 (선택사항)

### 5. 데이터 보관 및 삭제

#### 5.1 개인정보 보관 기간
- 개인정보 보호법에 따른 보관 기간 준수
- 일반적으로 5년간 보관 후 삭제

#### 5.2 데이터 마스킹
- 탈퇴 회원의 개인정보 마스킹 처리
- 이름, 전화번호, 이메일 등 민감 정보 처리

#### 5.3 통계 데이터
- 출석 통계, 매출 통계 등은 익명화하여 보관
- 개인 식별이 불가능한 형태로 변환

### 6. 로그 및 감사

#### 6.1 탈퇴 로그
- 탈퇴 일시, 탈퇴 사유 기록
- 관리자 확인용 로그 저장

#### 6.2 감사 추적
- 탈퇴 전후 데이터 변경 이력 추적
- 문제 발생 시 복구 가능하도록 로그 보관

### 7. 예외 처리

#### 7.1 트랜잭션 관리
- ✅ 현재 구현: @Transactional 사용
- 추가 고려사항:
  - 연관 데이터 처리 실패 시 롤백 처리
  - 부분 실패 시 재시도 로직

#### 7.2 에러 처리
- ✅ 현재 구현: 비밀번호 불일치, 탈퇴 실패 등 처리
- 추가 고려사항:
  - 네트워크 오류, DB 오류 등 예외 상황 처리
  - 사용자 친화적인 에러 메시지

### 8. 테스트 필요 사항

#### 8.1 단위 테스트
- 비밀번호 확인 로직 테스트
- 탈퇴 처리 성공/실패 케이스 테스트

#### 8.2 통합 테스트
- 회원권이 있는 회원 탈퇴 테스트
- PT 예약이 있는 회원 탈퇴 테스트
- 락커를 사용 중인 회원 탈퇴 테스트

#### 8.3 시나리오 테스트
- 정상 탈퇴 시나리오
- 비밀번호 오류 시나리오
- 연관 데이터가 있는 경우 탈퇴 시나리오

## 권장 사항

### 즉시 구현 권장
1. **연관 데이터 처리 로직 추가**
   - 회원권, PT 예약, 락커 상태 변경 처리
   
2. **탈퇴 사유 수집**
   - 서비스 개선을 위한 데이터 수집

3. **탈퇴 완료 페이지**
   - 사용자에게 명확한 안내 제공

### 향후 개선 사항
1. **유예 기간 기능**
   - 30일 유예 기간 후 완전 삭제
   
2. **데이터 마스킹**
   - 개인정보 보호 강화
   
3. **재가입 제한**
   - 동일 정보로 재가입 방지

4. **자동 환불 처리**
   - 미사용 서비스 자동 환불

## 참고사항

- 현재 구현은 **SOFT DELETE** 방식으로 STATUS만 변경
- 실제 데이터는 보관되므로 복구 가능
- 개인정보 보호법 준수를 위해 일정 기간 후 완전 삭제 고려 필요
- 연관 데이터 처리 로직은 비즈니스 요구사항에 따라 추가 구현 필요

