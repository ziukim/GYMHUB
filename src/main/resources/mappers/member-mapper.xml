<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.gymhub.model.mapper.MemberMapper">
    <resultMap id="memberResultMap" type="Member">
        <result column="MEMBER_NO" property="memberNo"/>
        <result column="MEMBER_TYPE" property="memberType"/>
        <result column="MEMBER_ID" property="memberId"/>
        <result column="MEMBER_PWD" property="memberPwd"/>
        <result column="MEMBER_NAME" property="memberName"/>
        <result column="MEMBER_ADDRESS" property="memberAddress"/>
        <result column="MEMBER_PHONE" property="memberPhone"/>
        <result column="MEMBER_BIRTH" property="memberBirth"/>
        <result column="STATUS" property="status"/>
        <result column="MEMBER_CREATEAT" property="memberCreateat"/>
        <result column="MEMBER_UPDATEAT" property="memberUpdateat"/>
        <result column="MEMBER_EMAIL" property="memberEmail"/>
        <result column="MEMBER_PHOTO_PATH" property="memberPhotoPath"/>
        <result column="GYM_NO" property="gymNo"/>
        <result column="TRAINER_LICENSE" property="trainerLicense"/>
        <result column="TRAINER_CAREER" property="trainerCareer"/>
        <result column="TRAINER_AWARD" property="trainerAward"/>
    </resultMap>

    <select id="getMemberById" parameterType="string" resultMap="memberResultMap">
        SELECT MEMBER_NO,
        MEMBER_TYPE,
        MEMBER_ID,
        MEMBER_PWD,
        MEMBER_NAME,
        MEMBER_ADDRESS,
        MEMBER_PHONE,
        MEMBER_BIRTH,
        STATUS,
        MEMBER_CREATEAT,
        MEMBER_UPDATEAT,
        MEMBER_EMAIL,
        MEMBER_PHOTO_PATH,
        GYM_NO,
        TRAINER_LICENSE,
        TRAINER_CAREER,
        TRAINER_AWARD
        FROM MEMBER
        WHERE MEMBER_ID = #{memberId}
        AND STATUS = 'Y'
    </select>

    <select id="getMemberCountById" resultType="_int">
        SELECT COUNT(*)
        FROM MEMBER
        WHERE MEMBER_ID = #{memberId}
    </select>

    <!-- 로그인용 회원 조회 (아이디와 상태만 확인) -->
    <select id="getMemberForLogin" parameterType="string" resultMap="memberResultMap">
        SELECT MEMBER_NO,
        MEMBER_TYPE,
        MEMBER_ID,
        MEMBER_PWD,
        MEMBER_NAME,
        MEMBER_ADDRESS,
        MEMBER_PHONE,
        MEMBER_BIRTH,
        STATUS,
        MEMBER_CREATEAT,
        MEMBER_UPDATEAT,
        MEMBER_EMAIL,
        MEMBER_PHOTO_PATH,
        GYM_NO,
        TRAINER_LICENSE,
        TRAINER_CAREER,
        TRAINER_AWARD
        FROM MEMBER
        WHERE MEMBER_ID = #{memberId}
        AND STATUS = 'Y'
    </select>

    <insert id="addMember" parameterType="Member">
        <selectKey keyProperty="memberNo" resultType="_int" order="BEFORE">
            SELECT SEQ_MNO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO MEMBER
        (
        MEMBER_NO,
        MEMBER_TYPE,
        MEMBER_ID,
        MEMBER_PWD,
        MEMBER_NAME,
        MEMBER_ADDRESS,
        MEMBER_PHONE,
        MEMBER_BIRTH,
        MEMBER_EMAIL,
        GYM_NO,
        TRAINER_LICENSE,
        TRAINER_CAREER,
        TRAINER_AWARD
        )
        VALUES(
        #{memberNo},
        #{memberType},
        #{memberId},
        #{memberPwd},
        #{memberName},
        #{memberAddress},
        #{memberPhone},
        #{memberBirth},
        #{memberEmail},
        #{gymNo},
        #{trainerLicense},
        #{trainerCareer},
        #{trainerAward}
        )
    </insert>

    <update id="updateMemberInfo" parameterType="Member">
        UPDATE MEMBER
        <set>
            MEMBER_NAME = #{memberName},
            MEMBER_PHONE = #{memberPhone},
            MEMBER_EMAIL = #{memberEmail},
            MEMBER_ADDRESS = #{memberAddress},
            MEMBER_UPDATEAT = SYSDATE,
            <if test="memberBirth != null">
                MEMBER_BIRTH = #{memberBirth},
            </if>
            <!-- 트레이너 정보는 null이 아닐 때만 업데이트 -->
            <if test="trainerCareer != null">
                TRAINER_CAREER = #{trainerCareer},
            </if>
            <if test="trainerLicense != null">
                TRAINER_LICENSE = #{trainerLicense},
            </if>
            <if test="trainerAward != null">
                TRAINER_AWARD = #{trainerAward},
            </if>
        </set>
        WHERE MEMBER_NO = #{memberNo}
    </update>

    <!-- 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE MEMBER
        SET MEMBER_PWD = #{memberPwd},
        MEMBER_UPDATEAT = SYSDATE
        WHERE MEMBER_NO = #{memberNo}
    </update>

    <!-- 헬스장 등록용 회원 조회 (gym_no가 null인 회원만 조회) -->
    <select id="getMemberByIdForGymRegistration" parameterType="string" resultMap="memberResultMap">
        SELECT MEMBER_NO,
        MEMBER_TYPE,
        MEMBER_ID,
        MEMBER_PWD,
        MEMBER_NAME,
        MEMBER_ADDRESS,
        MEMBER_PHONE,
        MEMBER_BIRTH,
        STATUS,
        MEMBER_CREATEAT,
        MEMBER_UPDATEAT,
        MEMBER_EMAIL,
        MEMBER_PHOTO_PATH,
        GYM_NO,
        TRAINER_LICENSE,
        TRAINER_CAREER,
        TRAINER_AWARD
        FROM MEMBER
        WHERE MEMBER_ID = #{memberId}
        AND STATUS = 'Y'
        AND GYM_NO IS NULL
    </select>
</mapper>