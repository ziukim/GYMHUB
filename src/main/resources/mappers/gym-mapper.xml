<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.gymhub.model.mapper.GymMapper">
    <resultMap id="gymResultMap" type="Gym">
        <result column="GYM_NO" property="gymNo"/>
        <result column="GYM_NAME" property="gymName"/>
        <result column="GYM_OWNER" property="gymOwner"/>
        <result column="GYM_PHONE" property="gymPhone"/>
        <result column="GYM_ADDRESS" property="gymAddress"/>
        <result column="STATUS" property="status"/>
        <result column="GYM_CREATEAT" property="gymCreateat"/>
        <result column="GYM_UPDATEAT" property="gymUpdateat"/>
        <result column="GYM_PHOTO_PATH" property="gymPhotoPath"/>
        <result column="ATT_CACHE_NO" property="attCacheNo"/>
    </resultMap>

    <insert id="insertGym" parameterType="Gym">
        <selectKey keyProperty="gymNo" resultType="_int" order="BEFORE">
            SELECT SEQ_GYM_NO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO GYM (
        GYM_NO,
        GYM_NAME,
        GYM_OWNER,
        GYM_PHONE,
        GYM_ADDRESS,
        ATT_CACHE_NO
        ) VALUES (
        #{gymNo},
        #{gymName},
        #{gymOwner},
        #{gymPhone},
        #{gymAddress},
        #{attCacheNo}
        )
    </insert>
    <select id="selectGymWithDetailByNo" parameterType="_int" resultMap="gymResultMap">
        SELECT
        G.GYM_NO,
        G.GYM_NAME,
        G.GYM_OWNER,
        G.GYM_PHONE,
        G.GYM_ADDRESS,
        G.STATUS,
        G.GYM_CREATEAT,
        G.GYM_UPDATEAT,
        G.GYM_PHOTO_PATH,
        G.ATT_CACHE_NO,
        GD.INTRO,
        GD.FACILITIES_INFO,
        GD.DETAIL_ADDRESS,
        GD.WEEK_BUSINESS_HOUR,
        GD.WEEKEND_BUSINESS_HOUR
        FROM GYM G
        LEFT JOIN GYM_DETAIL GD ON G.GYM_NO = GD.GYM_NO
        WHERE G.GYM_NO = #{gymNo}
        AND G.STATUS = 'Y'
    </select>
    <!-- 모든 헬스장 목록 조회 -->
    <select id="selectAllGyms" resultMap="gymResultMap">
        SELECT
        G.GYM_NO,
        G.GYM_NAME,
        G.GYM_OWNER,
        G.GYM_PHONE,
        G.GYM_ADDRESS,
        G.STATUS,
        G.GYM_CREATEAT,
        G.GYM_UPDATEAT,
        G.GYM_PHOTO_PATH,
        G.ATT_CACHE_NO,
        GD.INTRO,
        GD.FACILITIES_INFO,
        GD.DETAIL_ADDRESS,
        GD.WEEK_BUSINESS_HOUR,
        GD.WEEKEND_BUSINESS_HOUR
        FROM GYM G
        LEFT JOIN GYM_DETAIL GD ON G.GYM_NO = GD.GYM_NO
        WHERE G.STATUS = 'Y'
        ORDER BY G.GYM_NO DESC
    </select>
    <update id="updateProfileImage">
        UPDATE GYM
        SET GYM_PHOTO_PATH = #{photoPath},
        GYM_UPDATEAT = SYSDATE
        WHERE GYM_NO = #{gymNo}
    </update>
</mapper>