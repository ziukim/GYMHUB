<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.gymhub.model.mapper.PtScheduleMapper">

    <!-- 회원의 활성 PT 이용권 정보 조회 -->
    <select id="selectActivePtPass" parameterType="_int" resultType="map">
        SELECT 
            PT_PASS_NO,
            PT_TOTAL_COUNT,
            PT_END
        FROM PT_PASS
        WHERE MEMBER_NO = #{memberNo}
          AND (PT_END IS NULL OR PT_END &gt;= TRUNC(SYSDATE))
        ORDER BY 
            CASE 
                WHEN PT_END IS NULL THEN 0
                ELSE 1
            END,
            PT_END DESC,
            PT_PASS_NO ASC
        FETCH FIRST 1 ROW ONLY
    </select>

    <!-- PT 사용 완료 횟수 조회 (예약 확정된 PT) -->
    <select id="countCompletedPtReservations" parameterType="_int" resultType="_int">
        SELECT COUNT(*)
        FROM PT_RESERVE
        WHERE PT_PASS_NO = #{ptPassNo}
          AND PT_RESERVE_STATUS = 'Y'
    </select>

</mapper>

